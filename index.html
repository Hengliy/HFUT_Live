<html>
	<head>
		<meta charset="utf-8">
		<title>校内直播平台 By Netcan</title>
		<link rel="stylesheet" href="node_modules/semantic-ui/dist/semantic.min.css" type="text/css" media="all" />
	</head>
	<body style="background-color: #CCC4C2">

		<div class="ui white massive main menu">
			<div class="ui container">
				<a href="/" class="header item">
					HFUT直播平台
				</a>
				<div class="right menu">
					<a class="item" href="help.html">
					    直播教程
					</a>
					<a class="item" id="#onlineCnt">
						平台在线人数：<i class="home icon" id="roomHolder"></i> / <i class="user icon" id="onlineUser"></i>
					</a>
				</div>
			</div>
		</div>

		<div class="ui container">
			<div id="room" class ="ui four column grid">
			</div>
		</div>

		<script src="node_modules/jquery/dist/jquery.min.js"></script>
		<script src="node_modules/semantic-ui/dist/semantic.min.js"></script>
		<script src="node_modules/socket.io-client/dist/socket.io.js"></script>

		<script>
			var api = "api.php";
			function getRoom() {
				$.ajax({
					url: api + "?getRoom",
					type: "GET",
					dataType: "json",
					success: function(a) {
						var content = "";
						for(var i = 0; i < a.length; ++i)
							content += "<div class='column'>"
								+ "<div class='ui card'>" +
								"<a href='player.html?room="+ a[i] + "'>"+
								"<img class='ui image' width=260.75 height=195.56 src='live/"+ a[i] + ".jpg?" + new Date().getTime() + "'  title='"+ a[i] +"'>" +
								"</a>" +
								'<div class="content">' +
								'<a class="header" href=player.html?room=' + a[i] + '>'+ a[i] +'</a>' +
								'</div>' +
								"</div>" +
								"</div>";

						$('#room').html(content);
						$('#roomHolder').text(a.length);
						// console.log(content);
					}
				});
			}
			getRoom();
			setInterval(getRoom, 20000);

			var socket = io("http://172.18.72.13:2120");

			$.ajax({
				url: api + "?getUid",
				type: "GET",
				dataType: "json",
				success: function(uid) {
				//	console.log(uid);
					socket.on('connect', function(){socket.emit('login', uid);});
				}
			});

			// socket.on('new_msg', function(msg){alert(msg);});

			socket.on('update_online_count', function(online_stat){
				online_stat = JSON.parse(online_stat);
				$('#onlineUser').text(online_stat.online_count_now)
				// console.log(online_stat);
			});

		</script>
	</body>

</html>
